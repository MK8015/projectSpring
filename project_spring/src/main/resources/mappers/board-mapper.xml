<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mappers.board">

	<!-- 글 목록 보기 -->
	<select id="listArticle" resultType="BoardVo">
		select rownum rnum, a.* from 
          		(select * from t_board
          		 order by re_group desc, re_seq asc) a
	</select>
	
	<!-- 글 번호 선택 -->
	<select id="selectByBno" resultType="BoardVo">
		select * from t_board
		where bno = #{bno}
	</select>
	
	<!-- 글 수정 -->
	<update id="updateArticle">
		update t_board set
			title = #{title},
			content = #{content},
			regdate = sysdate
		where bno = #{bno}
	</update>
	
	<!-- 글 삭제 -->
	<delete id="deleteArticle">
		delete from t_board
		where bno = #{bno}
	</delete>
	
	<!-- 조회수 증가 -->
	<update id="updateViewcnt">
		update t_board set
			viewcnt = viewcnt + 1
		where bno = #{bno}
	</update>
	
	<!-- bno.nextval -->
	<select id="getNextVal" resultType="int">
		select seq_board_bno.nextval from dual
	</select>
	
	
	<!-- 글등록 -->
	<insert id="insertArticle">
		insert into t_board
			(bno, title, content, pic, writer, re_group, secret, password)
		values
			(#{bno}, #{title}, #{content}, #{pic, jdbcType=VARCHAR}, 
				#{writer}, #{bno}, #{secret}, #{password})
	</insert>
	
	<!-- 답글 등록 -->
	<insert id="insertReply">
		insert into t_board
			(bno, title, content, writer, re_group, re_seq, re_level)
		values
			(seq_board_bno.nextval, #{title}, #{content}, #{writer},
			 #{re_group}, #{re_seq} + 1, #{re_level} + 1)
	</insert>
	
	
	
	<!-- 글 번호 선택 -->
	<select id="selectByRegroup" resultType="BoardVo">
		select * from t_board
		where re_group = #{re_group}
	</select>
	
	
	<!-- 출력 순서 업데이트 -->
	<update id="updateReSeq">
		<![CDATA[ 
		update t_board set
			re_seq = re_seq + 1
		where re_group = #{re_group}
		and re_seq > #{re_seq}
		]]>
	</update>
	
	
	
	
	
	
	
	
	
</mapper>